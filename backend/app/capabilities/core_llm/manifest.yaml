code: core_llm
display_name: "Core LLM Tools"
version: "1.0.0"
description: "Generic LLM generation, structured extraction and other core LLM operations"
side_effect_level: "readonly"

tools:
  - name: generate
    description: "Basic one-time text generation/rewriting"
    backend: "app.capabilities.core_llm.services.generate:run"
    input_schema:
      type: object
      properties:
        prompt:
          type: string
        system_prompt:
          type: string
        temperature:
          type: number
          default: 0.7
        max_tokens:
          type: integer
        llm_provider:
          type: object
          description: "LLM provider object (optional, will be retrieved from profile)"
        locale:
          type: string
          description: "Locale code (e.g., 'zh-TW', 'en'). Deprecated: use target_language instead. Kept for backward compatibility."
        target_language:
          type: string
          description: "Target language for output (e.g., 'zh-TW', 'en', 'ja-JP'). Primary parameter. Priority: target_language > locale"
    output_schema:
      type: object
      properties:
        text:
          type: string
        usage:
          type: object
          properties:
            prompt_tokens:
              type: integer
            completion_tokens:
              type: integer

  - name: structured_extract
    description: "Extract structured JSON from long text based on schema/description"
    backend: "app.capabilities.core_llm.services.structured:extract"
    input_schema:
      type: object
      properties:
        text:
          type: string
        schema_description:
          type: string
          description: "Expected JSON schema description"
        example_output:
          type: object
          description: "Example output (optional)"
        llm_provider:
          type: object
        locale:
          type: string
          description: "Locale code (e.g., 'zh-TW', 'en'). Deprecated: use target_language instead. Kept for backward compatibility."
        target_language:
          type: string
          description: "Target language for extraction (e.g., 'zh-TW', 'en', 'ja-JP'). Primary parameter. Priority: target_language > locale"
    output_schema:
      type: object
      properties:
        extracted_data:
          type: object
        confidence:
          type: number

  - name: filter_features
    description: "Filter feature data to remove redundant fields like embeddings for LLM processing"
    backend: "app.capabilities.core_llm.services.data_utils:filter_features"
    input_schema:
      type: object
      properties:
        features_data:
          description: "Feature data (single dict or list of dicts) to filter"
          oneOf:
            - type: object
            - type: array
              items:
                type: object
        remove_embeddings:
          type: boolean
          default: true
          description: "Whether to remove visual_style_embedding vector (removes large vector data, keeps metadata)"
        keep_embedding_metadata:
          type: boolean
          default: true
          description: "Whether to keep embedding_dim and has_embedding metadata after removing vector"
    output_schema:
      type: object
      description: "Filtered feature data with same structure as input"
      oneOf:
        - type: object
        - type: array
          items:
            type: object

  - name: simplify_photos
    description: "Trim Unsplash photo objects to essential fields and limit count to reduce tokens"
    backend: "app.capabilities.core_llm.services.data_utils:simplify_photos"
    input_schema:
      type: object
      properties:
        photos_data:
          type: array
          items:
            type: object
        keep_fields:
          type: array
          items:
            type: string
          description: "Optional whitelist of fields to keep (default: id, urls, user, description, alt_description, color, width, height, tags)"
        max_items:
          type: integer
          default: 10
          description: "Max photos to keep"
    output_schema:
      type: array
      items:
        type: object

  - name: summarize_features
    description: "Aggregate a list of feature dicts into a compact statistical summary"
    backend: "app.capabilities.core_llm.services.data_utils:summarize_features"
    input_schema:
      type: object
      properties:
        features_data:
          type: array
          items:
            type: object
    output_schema:
      type: object

  - name: sample_features
    description: "Return a small sample of feature dicts to provide concrete examples without sending full payload"
    backend: "app.capabilities.core_llm.services.data_utils:sample_features"
    input_schema:
      type: object
      properties:
        features_data:
          type: array
          items:
            type: object
        max_items:
          type: integer
          default: 3
    output_schema:
      type: array
      items:
        type: object

  - name: build_search_query
    description: "Build a safe search query from extracted keywords with fallbacks to user input"
    backend: "app.capabilities.core_llm.services.data_utils:build_search_query"
    input_schema:
      type: object
      properties:
        search_keywords:
          type: object
        theme_keywords:
          type: array
          items:
            type: string
        style_preferences:
          type: array
          items:
            type: string
    output_schema:
      type: object
      properties:
        query:
          type: string

  - name: build_search_query
    description: "Build Unsplash search query with fallback to input keywords"
    backend: "app.capabilities.core_llm.services.data_utils:build_search_query"
    input_schema:
      type: object
      properties:
        search_keywords:
          type: object
          description: "Expanded keywords from LLM (optional)"
        theme_keywords:
          type: array
          items:
            type: string
          description: "Fallback theme keywords from input"
        style_preferences:
          type: array
          items:
            type: string
          description: "Fallback style preferences from input"
    output_schema:
      type: object
      properties:
        query:
          type: string
