{
  "version": "1.0",
  "playbook_code": "unsplash_visual_lens_extraction",
  "kind": "user_workflow",
  "steps": [
    {
      "id": "expand_keywords",
      "tool": "core_llm.structured_extract",
      "inputs": {
        "text": "Theme: {{input.theme_keywords}}\nStyle Preferences: {{input.style_preferences}}\n\nPlease generate Unsplash image search keywords, including:\n- Core theme words (3-5)\n- Scene words (2-4)\n- Emotion words (2-3)\n- Style words (2-3)",
        "schema_description": "A JSON object with properties: core_themes (array of strings), scenes (array of strings), emotions (array of strings), styles (array of strings)"
      },
      "outputs": {
        "search_keywords": "extracted_data"
      }
    },
    {
      "id": "search_photos",
      "tool": "unsplash.unsplash_search_photos",
      "inputs": {
        "workspace_id": "{{input.workspace_id}}",
        "query": "{{step.expand_keywords.core_themes[0]}} {{step.expand_keywords.core_themes[1]}} {{step.expand_keywords.styles[0]}}",
        "per_page": 30,
        "order_by": "relevance"
      },
      "outputs": {
        "photos": "results"
      },
      "depends_on": ["expand_keywords"]
    },
    {
      "id": "download_images",
      "tool": "unsplash.download_temp_image",
      "for_each": "step.search_photos.photos",
      "inputs": {
        "image_url": "{{item.urls.regular}}",
        "photo_id": "{{item.id}}",
        "workspace_id": "{{input.workspace_id}}"
      },
      "outputs": {
        "temp_path": "temp_path"
      },
      "depends_on": ["search_photos"]
    },
    {
      "id": "extract_features",
      "tool": "mind_lens.mind_lens_extract_features",
      "for_each": "step.download_images.results",
      "inputs": {
        "image_path": "{{item.temp_path}}",
        "include_mood": true
      },
      "outputs": {
        "features": ""
      },
      "depends_on": ["download_images"]
    },
    {
      "id": "generate_feature_summary",
      "tool": "core_llm.structured_extract",
      "inputs": {
        "text": "Extracted Features from Images: {{step.extract_features.results}}\n\nTheme Keywords: {{input.theme_keywords}}\nStyle Preferences: {{input.style_preferences}}\n\nPlease analyze all extracted features and generate a statistical summary including:\n1. Color Analysis: Calculate average color palette, identify main color tones, calculate saturation and contrast ranges\n2. Composition Analysis: Identify common composition types, calculate average whitespace ratio, identify subject position preferences\n3. Style Analysis: Identify main visual styles, calculate style consistency\n4. Mood Analysis: Extract emotion keywords, identify narrative distance, analyze rhythm",
        "schema_description": "A JSON object with properties: color_analysis (object with main_colors, saturation_range, contrast_range), composition_analysis (object with common_composition_types, whitespace_ratio_range, subject_position_preferences), style_analysis (object with main_styles, style_consistency), mood_analysis (object with emotion_keywords, narrative_distance, rhythm)"
      },
      "outputs": {
        "feature_summary": "extracted_data"
      },
      "depends_on": ["extract_features"]
    },
    {
      "id": "generate_lens_schema",
      "tool": "core_llm.structured_extract",
      "inputs": {
        "text": "Feature Summary: {{step.generate_feature_summary.feature_summary}}\n\nTheme Keywords: {{input.theme_keywords}}\nStyle Preferences: {{input.style_preferences}}\nLens Name: {{input.lens_name}}\n\nPlease generate a complete Visual Lens data object based on the feature summary and requirements. The object should include:\n- lens_id: A unique identifier (e.g., 'unsplash_' + lens_name in lowercase with spaces replaced by underscores)\n- name: The lens name from input\n- description: A description mentioning the theme keywords and style preferences\n- source_photographer: null (or photographer name if available)\n- source_images: Array of image URLs from search results (use urls.regular from step.search_photos.photos)\n- source_image_references: Complete image reference objects from search results (use full photo objects from step.search_photos.photos)\n- image_vocabulary: Object with themes (array), distances (array), angles (array), depth_of_field (array), dynamics (array)\n- composition_rules: Object with whitespace_ratio (float 0-1), subject_position (string or null), horizon_position (string or null), geometry_preference (array)\n- light_color_tokens: Object with color_temperature (string or null), contrast_level (string or null), saturation (float 0-1), color_palette (array of HEX colors like #RRGGBB), forbidden_colors (array of HEX colors)\n- mood_narrative: Object with emotion_keywords (array), narrative_distance (string or null), rhythm (string or null)\n- web_translation_rules: Object with hero_image_preference (array), image_text_ratio (string), layout_density (string), border_radius (string or null), shadow_style (string or null), noise_texture (boolean or null), animation_rhythm (string)\n- style_guardrails: Object with forbidden_elements (array), required_elements (array)",
        "schema_description": "A JSON object with properties: lens_id (string, required), name (string, required), description (string), source_photographer (string or null), source_images (array of strings), source_image_references (array of objects), image_vocabulary (object with themes, distances, angles, depth_of_field, dynamics arrays), composition_rules (object with whitespace_ratio float, subject_position, horizon_position, geometry_preference), light_color_tokens (object with color_temperature, contrast_level, saturation float, color_palette array of HEX colors, forbidden_colors array of HEX colors), mood_narrative (object with emotion_keywords array, narrative_distance, rhythm), web_translation_rules (object with hero_image_preference array, image_text_ratio string, layout_density string, border_radius, shadow_style, noise_texture boolean, animation_rhythm string), style_guardrails (object with forbidden_elements array, required_elements array)"
      },
      "outputs": {
        "lens_data": "extracted_data"
      },
      "depends_on": ["generate_feature_summary", "search_photos"]
    },
    {
      "id": "create_visual_lens",
      "tool": "visual_lens.visual_lens_create",
      "inputs": {
        "workspace_id": "{{input.workspace_id}}",
        "lens_data": "{{step.generate_lens_schema.lens_data}}"
      },
      "outputs": {
        "saved_lens": ""
      },
      "depends_on": ["generate_lens_schema", "search_photos"]
    }
  ],
  "inputs": {
    "theme_keywords": {
      "type": "list[string]",
      "required": true,
      "description": "Theme keywords for Unsplash search (e.g., ['yoga', 'travel', 'health products'])"
    },
    "style_preferences": {
      "type": "list[string]",
      "required": true,
      "description": "Style preferences for filtering results (e.g., ['minimalist', 'documentary', 'still life'])"
    },
    "lens_name": {
      "type": "string",
      "required": true,
      "description": "Name for the generated Visual Lens (e.g., 'Minimalist Yoga Style')"
    },
    "photographer_mode": {
      "type": "string",
      "default": "single",
      "description": "Photographer mode: 'single' or 'multiple'"
    }
  },
  "outputs": {
    "saved_lens": {
      "type": "object",
      "description": "Saved Visual Lens information",
      "source": "step.create_visual_lens.saved_lens"
    },
    "search_keywords": {
      "type": "object",
      "description": "Expanded search keywords",
      "source": "step.expand_keywords.search_keywords"
    },
    "photos": {
      "type": "list[object]",
      "description": "Unsplash search results",
      "source": "step.search_photos.photos"
    }
  }
}

