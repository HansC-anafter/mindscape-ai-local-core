{
  "version": "1.0",
  "playbook_code": "major_proposal_writing",
  "kind": "user_workflow",
  "steps": [
    {
      "id": "parse_template",
      "tool": "core_llm.structured_extract",
      "inputs": {
        "text": "{{input.user_request}}\n\n{{input.context}}\n\n{{input.template_files}}\n\nParse template. Upload guideline/template files, automatically extract text content and analyze template structure.",
        "schema_description": "A JSON object with the following properties: 1) template_structure: array of objects, each with section_name (string), section_type (string: 'required', 'optional'), order (integer), description (string), and requirements (array of strings). 2) extracted_text: string (extracted text content from template). 3) template_metadata: object with template_type (string: 'gov_grant', 'loan', 'startup', 'other'), document_format (string), and key_sections (array of strings)."
      },
      "outputs": {
        "template_structure": "extracted_data.template_structure",
        "extracted_text": "extracted_data.extracted_text",
        "template_metadata": "extracted_data.template_metadata"
      }
    },
    {
      "id": "create_proposal_project",
      "tool": "core_llm.structured_extract",
      "inputs": {
        "text": "Template Structure: {{step.parse_template.template_structure}}\n\nProject Name: {{input.project_name}}\n\nCreate proposal project. Confirm template structure and create new proposal project.",
        "schema_description": "A JSON object with the following properties: 1) project_id: string (created project ID). 2) template_id: string (template ID). 3) project_structure: object with sections (array of section objects), confirmed_structure (boolean), and adjustments (array of strings if any)."
      },
      "outputs": {
        "project_id": "extracted_data.project_id",
        "template_id": "extracted_data.template_id",
        "project_structure": "extracted_data.project_structure"
      },
      "depends_on": ["parse_template"]
    },
    {
      "id": "draft_sections",
      "tool": "core_llm.structured_extract",
      "inputs": {
        "text": "Project Structure: {{step.create_proposal_project.project_structure}}\n\nUser Information: {{input.user_information}}\n\nDraft sections. Guide user to fill in content section by section, AI generates section drafts based on user information.",
        "schema_description": "A JSON object with the following properties: 1) section_drafts: array of objects, each with section_name (string), section_content (string), status (string: 'draft', 'reviewed', 'finalized'), order (integer), and user_feedback (string if any). 2) current_section: string (currently being drafted section). 3) completion_status: object with completed_sections (integer), total_sections (integer), and progress_percentage (number)."
      },
      "outputs": {
        "section_drafts": "extracted_data.section_drafts",
        "current_section": "extracted_data.current_section",
        "completion_status": "extracted_data.completion_status"
      },
      "depends_on": ["create_proposal_project"]
    },
    {
      "id": "assemble_proposal",
      "tool": "core_llm.structured_extract",
      "inputs": {
        "text": "Section Drafts: {{step.draft_sections.section_drafts}}\n\nTemplate Structure: {{step.parse_template.template_structure}}\n\nAssemble proposal. Assemble all sections into complete proposal document and export as DOCX format.",
        "schema_description": "A JSON object with the following properties: 1) proposal_markdown: string (complete proposal in markdown format). 2) proposal_docx_path: string (path to generated DOCX file). 3) final_structure: object with sections (array of finalized section objects), table_of_contents (array of strings), and document_metadata (object)."
      },
      "outputs": {
        "proposal_markdown": "extracted_data.proposal_markdown",
        "proposal_docx_path": "extracted_data.proposal_docx_path",
        "final_structure": "extracted_data.final_structure"
      },
      "depends_on": ["draft_sections"]
    }
  ],
  "inputs": {
    "user_request": {
      "type": "string",
      "required": true,
      "description": "User's request for proposal writing"
    },
    "context": {
      "type": "string",
      "default": "",
      "description": "Additional context about the proposal"
    },
    "template_files": {
      "type": "string",
      "required": true,
      "description": "Guideline/template files (PDF/DOCX)"
    },
    "template_type": {
      "type": "string",
      "default": "other",
      "description": "Template type (gov_grant, loan, startup, other)"
    },
    "project_name": {
      "type": "string",
      "required": true,
      "description": "Project name for the proposal"
    },
    "user_information": {
      "type": "string",
      "default": "",
      "description": "User information for generating content"
    }
  },
  "outputs": {
    "template_structure": {
      "type": "list[object]",
      "description": "Template structure extracted",
      "source": "step.parse_template.template_structure"
    },
    "extracted_text": {
      "type": "string",
      "description": "Extracted text from template",
      "source": "step.parse_template.extracted_text"
    },
    "template_metadata": {
      "type": "object",
      "description": "Template metadata",
      "source": "step.parse_template.template_metadata"
    },
    "project_id": {
      "type": "string",
      "description": "Created proposal project ID",
      "source": "step.create_proposal_project.project_id"
    },
    "template_id": {
      "type": "string",
      "description": "Template ID",
      "source": "step.create_proposal_project.template_id"
    },
    "project_structure": {
      "type": "object",
      "description": "Project structure",
      "source": "step.create_proposal_project.project_structure"
    },
    "section_drafts": {
      "type": "list[object]",
      "description": "Section drafts",
      "source": "step.draft_sections.section_drafts"
    },
    "current_section": {
      "type": "string",
      "description": "Currently being drafted section",
      "source": "step.draft_sections.current_section"
    },
    "completion_status": {
      "type": "object",
      "description": "Completion status",
      "source": "step.draft_sections.completion_status"
    },
    "proposal_markdown": {
      "type": "string",
      "description": "Complete proposal in markdown",
      "source": "step.assemble_proposal.proposal_markdown"
    },
    "proposal_docx_path": {
      "type": "string",
      "description": "Path to generated DOCX file",
      "source": "step.assemble_proposal.proposal_docx_path"
    },
    "final_structure": {
      "type": "object",
      "description": "Final proposal structure",
      "source": "step.assemble_proposal.final_structure"
    }
  }
}

