{
  "playbook_code": "yoga_coach_mapping",
  "version": "1.0.0",
  "display_name": {
    "zh-TW": "老師示範對位與導覽",
    "en": "Coach Mapping & Navigation"
  },
  "description": {
    "zh-TW": "把事件對位到老師示範影片的章節，讓使用者看到「那一秒」",
    "en": "Map events to teacher demo video chapters so users can see that exact moment"
  },
  "input_schema": {
    "type": "object",
    "required": ["priority_events", "asana_id", "teacher_demo_video"],
    "properties": {
      "priority_events": {
        "type": "array",
        "items": {
          "type": "object",
          "properties": {
            "type": {"type": "string"},
            "severity": {
              "type": "string",
              "enum": ["yellow", "red"]
            },
            "description": {"type": "string"},
            "value": {"type": "number"},
            "event_id": {"type": "string"}
          }
        }
      },
      "asana_id": {
        "type": "string"
      },
      "teacher_demo_video": {
        "type": "object",
        "properties": {
          "youtube_id": {"type": "string"},
          "chapters": {
            "type": "array",
            "items": {
              "type": "object",
              "properties": {
                "name": {"type": "string"},
                "start": {"type": "number"},
                "end": {"type": "number"},
                "error_tags": {
                  "type": "array",
                  "items": {"type": "string"}
                }
              }
            }
          }
        }
      },
      "segment_id": {
        "type": "string"
      }
    }
  },
  "output_schema": {
    "type": "object",
    "properties": {
      "segment_id": {"type": "string"},
      "asana_id": {"type": "string"},
      "teacher_demo_video": {"type": "string"},
      "playlist": {
        "type": "array",
        "items": {
          "type": "object",
          "properties": {
            "sequence": {"type": "number"},
            "event_id": {"type": "string"},
            "chapter": {"type": "string"},
            "start_time": {"type": "number"},
            "end_time": {"type": "number"},
            "youtube_link": {"type": "string"},
            "reason": {"type": "string"},
            "watch_duration": {"type": "number"},
            "context": {"type": "object"},
            "description": {"type": "object"}
          }
        }
      },
      "total_watch_time": {"type": "number"},
      "total_items": {"type": "number"}
    }
  },
  "data_locality": {
    "local_only": [],
    "cloud_allowed": [
      "priority_events",
      "teacher_demo_video",
      "playlist",
      "coach_mapping_results"
    ]
  },
  "required_capabilities": [
    "yogacoach.coach_mapping",
    "yogacoach.rubric_loader"
  ],
  "tools": [
    {
      "name": "coach_mapper",
      "capability": "yogacoach",
      "when": "always"
    },
    {
      "name": "rubric_loader",
      "capability": "yogacoach",
      "when": "always"
    }
  ],
  "decision_points": [
    {
      "condition": "len(playlist) > 0",
      "action": "continue",
      "next_playbook": "yoga_narration_script"
    },
    {
      "condition": "len(playlist) == 0",
      "action": "continue",
      "next_playbook": "yoga_narration_script",
      "note": "Continue even if no playlist items, narration can still be generated"
    }
  ]
}




