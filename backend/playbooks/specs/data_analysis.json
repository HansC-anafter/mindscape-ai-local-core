{
  "version": "1.0",
  "playbook_code": "data_analysis",
  "kind": "user_workflow",
  "steps": [
    {
      "id": "collect_data_metrics",
      "tool": "core_llm.structured_extract",
      "inputs": {
        "text": "{{input.user_request}}\n\n{{input.context}}\n\n{{input.data_files}}\n\nCollect data and metrics. Ask user to provide data files (CSV, Excel, JSON, or text), extract data from files using appropriate parsers, understand data structure and format, identify available metrics and dimensions, and verify data completeness and quality.",
        "schema_description": "A JSON object with the following properties: 1) data_structure: object with file_type (string), columns (array of strings), rows_count (integer), and data_format (string). 2) available_metrics: array of objects, each with metric_name (string), metric_type (string: 'numeric', 'categorical', 'date', 'text'), and description (string). 3) dimensions: array of strings (available dimensions for analysis). 4) data_quality: object with completeness (string: 'high', 'medium', 'low'), missing_values (integer), and quality_issues (array of strings)."
      },
      "outputs": {
        "data_structure": "extracted_data.data_structure",
        "available_metrics": "extracted_data.available_metrics",
        "dimensions": "extracted_data.dimensions",
        "data_quality": "extracted_data.data_quality"
      }
    },
    {
      "id": "identify_data_patterns",
      "tool": "core_llm.structured_extract",
      "inputs": {
        "text": "Data Structure: {{step.collect_data_metrics.data_structure}}\n\nAvailable Metrics: {{step.collect_data_metrics.available_metrics}}\n\nIdentify data patterns. Analyze data structure and relationships, identify patterns in the data (seasonal, cyclical, trends), detect correlations between variables, recognize data distributions and outliers, and map data relationships and dependencies.",
        "schema_description": "A JSON object with the following properties: 1) data_patterns: array of objects, each with pattern_type (string: 'seasonal', 'cyclical', 'trend', 'correlation', 'distribution'), pattern_description (string), variables_involved (array of strings), and strength (string: 'strong', 'moderate', 'weak'). 2) correlations: array of objects, each with variable1 (string), variable2 (string), correlation_type (string: 'positive', 'negative'), strength (string), and significance (string). 3) distributions: array of objects, each with variable (string), distribution_type (string), characteristics (array of strings), and outliers (array of values if any). 4) relationships: array of objects, each with relationship_type (string), variables (array of strings), and description (string)."
      },
      "outputs": {
        "data_patterns": "extracted_data.data_patterns",
        "correlations": "extracted_data.correlations",
        "distributions": "extracted_data.distributions",
        "relationships": "extracted_data.relationships"
      },
      "depends_on": ["collect_data_metrics"]
    },
    {
      "id": "analyze_trends_anomalies",
      "tool": "core_llm.structured_extract",
      "inputs": {
        "text": "Data Patterns: {{step.identify_data_patterns.data_patterns}}\n\nCorrelations: {{step.identify_data_patterns.correlations}}\n\nAnalyze trends and anomalies. Identify trends over time (if time-series data), detect anomalies and outliers, analyze changes and variations, compare different time periods or segments, and highlight significant changes or deviations.",
        "schema_description": "A JSON object with the following properties: 1) trends: array of objects, each with trend_name (string), direction (string: 'increasing', 'decreasing', 'stable', 'fluctuating'), timeframe (string), magnitude (string), and significance (string: 'high', 'medium', 'low'). 2) anomalies: array of objects, each with anomaly_type (string: 'outlier', 'spike', 'drop', 'pattern_break'), description (string), timestamp (string if applicable), value (string), and potential_cause (string). 3) changes: array of objects, each with change_type (string), period1 (string), period2 (string), change_magnitude (string), and significance (string). 4) variations: array of objects, each with variable (string), variation_type (string), description (string), and impact (string)."
      },
      "outputs": {
        "trends": "extracted_data.trends",
        "anomalies": "extracted_data.anomalies",
        "changes": "extracted_data.changes",
        "variations": "extracted_data.variations"
      },
      "depends_on": ["identify_data_patterns"]
    },
    {
      "id": "calculate_key_metrics",
      "tool": "core_llm.structured_extract",
      "inputs": {
        "text": "Available Metrics: {{step.collect_data_metrics.available_metrics}}\n\nData Patterns: {{step.identify_data_patterns.data_patterns}}\n\nCalculate key metrics. Compute relevant statistical metrics (mean, median, mode, standard deviation), calculate growth rates and percentages, compute ratios and proportions, generate summary statistics, and calculate performance indicators.",
        "schema_description": "A JSON object with the following properties: 1) statistical_metrics: array of objects, each with metric_name (string), metric_type (string: 'mean', 'median', 'mode', 'std_dev', 'variance', 'range'), value (number or string), and interpretation (string). 2) growth_rates: array of objects, each with metric (string), period1 (string), period2 (string), growth_rate (string), and percentage_change (string). 3) ratios: array of objects, each with ratio_name (string), numerator (string), denominator (string), value (number or string), and interpretation (string). 4) summary_statistics: object with total_records (integer), unique_values (object with key-value pairs), and data_range (object with min and max values). 5) performance_indicators: array of objects, each with indicator (string), value (string), benchmark (string if available), and status (string: 'above', 'at', 'below')."
      },
      "outputs": {
        "statistical_metrics": "extracted_data.statistical_metrics",
        "growth_rates": "extracted_data.growth_rates",
        "ratios": "extracted_data.ratios",
        "summary_statistics": "extracted_data.summary_statistics",
        "performance_indicators": "extracted_data.performance_indicators"
      },
      "depends_on": ["identify_data_patterns"]
    },
    {
      "id": "generate_analysis_report",
      "tool": "core_llm.structured_extract",
      "inputs": {
        "text": "Data Quality: {{step.collect_data_metrics.data_quality}}\n\nData Patterns: {{step.identify_data_patterns.data_patterns}}\n\nTrends: {{step.analyze_trends_anomalies.trends}}\n\nAnomalies: {{step.analyze_trends_anomalies.anomalies}}\n\nKey Metrics: {{step.calculate_key_metrics.statistical_metrics}}\n\nPerformance Indicators: {{step.calculate_key_metrics.performance_indicators}}\n\nGenerate analysis report. Compile all analysis findings and create structured analysis report with executive summary, data overview and quality assessment, pattern identification results, trend analysis and anomalies, key metrics and statistics, insights and observations, and recommendations.",
        "schema_description": "A JSON object with the following properties: 1) executive_summary: string (key findings and insights). 2) data_overview: object with data_structure (object), data_quality (object), and data_summary (string). 3) pattern_identification: object with patterns (array of pattern objects), correlations (array of correlation objects), and relationships (array of relationship objects). 4) trend_analysis: object with trends (array of trend objects), anomalies (array of anomaly objects), and significant_changes (array of change objects). 5) key_metrics: object with statistical_metrics (array of metric objects), growth_rates (array of growth objects), ratios (array of ratio objects), and performance_indicators (array of indicator objects). 6) insights: array of objects, each with insight (string), category (string), and significance (string). 7) recommendations: array of objects, each with recommendation (string), rationale (string), and priority (string: 'high', 'medium', 'low'). 8) visualization_suggestions: array of objects, each with chart_type (string), variables (array of strings), and purpose (string)."
      },
      "outputs": {
        "executive_summary": "extracted_data.executive_summary",
        "data_overview": "extracted_data.data_overview",
        "pattern_identification": "extracted_data.pattern_identification",
        "trend_analysis": "extracted_data.trend_analysis",
        "key_metrics": "extracted_data.key_metrics",
        "insights": "extracted_data.insights",
        "recommendations": "extracted_data.recommendations",
        "visualization_suggestions": "extracted_data.visualization_suggestions"
      },
      "depends_on": ["calculate_key_metrics", "analyze_trends_anomalies"]
    }
  ],
  "inputs": {
    "user_request": {
      "type": "string",
      "required": true,
      "description": "User's request for data analysis"
    },
    "context": {
      "type": "string",
      "default": "",
      "description": "Additional context about the data or analysis requirements"
    },
    "data_files": {
      "type": "string",
      "default": "",
      "description": "Data files to analyze (CSV, Excel, JSON, or text)"
    }
  },
  "outputs": {
    "data_structure": {
      "type": "object",
      "description": "Data structure and format",
      "source": "step.collect_data_metrics.data_structure"
    },
    "available_metrics": {
      "type": "list[object]",
      "description": "Available metrics for analysis",
      "source": "step.collect_data_metrics.available_metrics"
    },
    "dimensions": {
      "type": "list[string]",
      "description": "Available dimensions for analysis",
      "source": "step.collect_data_metrics.dimensions"
    },
    "data_quality": {
      "type": "object",
      "description": "Data quality assessment",
      "source": "step.collect_data_metrics.data_quality"
    },
    "data_patterns": {
      "type": "list[object]",
      "description": "Identified data patterns",
      "source": "step.identify_data_patterns.data_patterns"
    },
    "correlations": {
      "type": "list[object]",
      "description": "Correlations between variables",
      "source": "step.identify_data_patterns.correlations"
    },
    "distributions": {
      "type": "list[object]",
      "description": "Data distributions",
      "source": "step.identify_data_patterns.distributions"
    },
    "relationships": {
      "type": "list[object]",
      "description": "Data relationships and dependencies",
      "source": "step.identify_data_patterns.relationships"
    },
    "trends": {
      "type": "list[object]",
      "description": "Trends over time",
      "source": "step.analyze_trends_anomalies.trends"
    },
    "anomalies": {
      "type": "list[object]",
      "description": "Anomalies and outliers",
      "source": "step.analyze_trends_anomalies.anomalies"
    },
    "changes": {
      "type": "list[object]",
      "description": "Changes between periods",
      "source": "step.analyze_trends_anomalies.changes"
    },
    "variations": {
      "type": "list[object]",
      "description": "Variations in data",
      "source": "step.analyze_trends_anomalies.variations"
    },
    "statistical_metrics": {
      "type": "list[object]",
      "description": "Statistical metrics",
      "source": "step.calculate_key_metrics.statistical_metrics"
    },
    "growth_rates": {
      "type": "list[object]",
      "description": "Growth rates and percentages",
      "source": "step.calculate_key_metrics.growth_rates"
    },
    "ratios": {
      "type": "list[object]",
      "description": "Ratios and proportions",
      "source": "step.calculate_key_metrics.ratios"
    },
    "summary_statistics": {
      "type": "object",
      "description": "Summary statistics",
      "source": "step.calculate_key_metrics.summary_statistics"
    },
    "performance_indicators": {
      "type": "list[object]",
      "description": "Performance indicators",
      "source": "step.calculate_key_metrics.performance_indicators"
    },
    "executive_summary": {
      "type": "string",
      "description": "Executive summary of analysis",
      "source": "step.generate_analysis_report.executive_summary"
    },
    "data_overview": {
      "type": "object",
      "description": "Data overview and quality assessment",
      "source": "step.generate_analysis_report.data_overview"
    },
    "pattern_identification": {
      "type": "object",
      "description": "Pattern identification results",
      "source": "step.generate_analysis_report.pattern_identification"
    },
    "trend_analysis": {
      "type": "object",
      "description": "Trend analysis and anomalies",
      "source": "step.generate_analysis_report.trend_analysis"
    },
    "key_metrics": {
      "type": "object",
      "description": "Key metrics and statistics",
      "source": "step.generate_analysis_report.key_metrics"
    },
    "insights": {
      "type": "list[object]",
      "description": "Insights and observations",
      "source": "step.generate_analysis_report.insights"
    },
    "recommendations": {
      "type": "list[object]",
      "description": "Recommendations",
      "source": "step.generate_analysis_report.recommendations"
    },
    "visualization_suggestions": {
      "type": "list[object]",
      "description": "Visualization suggestions",
      "source": "step.generate_analysis_report.visualization_suggestions"
    }
  }
}

