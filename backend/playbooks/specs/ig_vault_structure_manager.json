{
  "version": "1.0.0",
  "playbook_code": "ig_vault_structure_manager",
  "kind": "user_workflow",
  "description": "Manage workspace structure for IG Post workflow. Supports initialization, validation, and content scanning.",
  "steps": [
    {
      "id": "init_structure",
      "tool": "ig_vault_structure_tool",
      "inputs": {
        "workspace_id": "{{input.workspace_id}}",
        "workspace_path": "{{input.workspace_path}}",
        "action": "init"
      },
      "outputs": {
        "structure_status": "result.structure_status",
        "created_folders": "result.created_folders",
        "missing_folders": "result.missing_folders",
        "is_valid": "result.is_valid"
      },
      "condition": "{{input.action == 'init'}}"
    },
    {
      "id": "validate_structure",
      "tool": "ig_vault_structure_tool",
      "inputs": {
        "workspace_id": "{{input.workspace_id}}",
        "workspace_path": "{{input.workspace_path}}",
        "action": "validate",
        "create_missing": "{{input.create_missing}}"
      },
      "outputs": {
        "is_valid": "result.is_valid",
        "missing_folders": "result.missing_folders",
        "structure_status": "result.structure_status"
      },
      "condition": "{{input.action == 'validate'}}"
    },
    {
      "id": "scan_content",
      "tool": "ig_vault_structure_tool",
      "inputs": {
        "workspace_id": "{{input.workspace_id}}",
        "workspace_path": "{{input.workspace_path}}",
        "action": "scan"
      },
      "outputs": {
        "content_index": "result.content_index",
        "post_count": "result.post_count",
        "series_count": "result.series_count",
        "idea_count": "result.idea_count"
      },
      "condition": "{{input.action == 'scan'}}"
    }
  ],
  "inputs": {
    "workspace_id": {
      "type": "string",
      "required": false,
      "description": "Workspace identifier"
    },
    "workspace_path": {
      "type": "string",
      "required": false,
      "description": "Custom workspace path (for backward compatibility/migration, not allowed in enterprise mode)"
    },
    "action": {
      "type": "string",
      "enum": ["init", "validate", "scan"],
      "default": "validate",
      "description": "Action to perform: init=initialize structure, validate=validate structure, scan=scan content"
    },
    "create_missing": {
      "type": "boolean",
      "default": false,
      "description": "Whether to create missing folders when validating"
    }
  },
  "outputs": {
    "structure_status": {
      "type": "string",
      "description": "Structure status (initialized, incomplete, valid, etc.)",
      "source": "step.init_structure.structure_status or step.validate_structure.structure_status"
    },
    "is_valid": {
      "type": "boolean",
      "description": "Whether workspace structure is valid",
      "source": "step.init_structure.is_valid or step.validate_structure.is_valid"
    },
    "created_folders": {
      "type": "list[string]",
      "description": "List of created folders (init action only)",
      "source": "step.init_structure.created_folders"
    },
    "missing_folders": {
      "type": "list[string]",
      "description": "List of missing folders",
      "source": "step.validate_structure.missing_folders"
    },
    "content_index": {
      "type": "object",
      "description": "Content index with posts, series, and ideas",
      "source": "step.scan_content.content_index"
    },
    "post_count": {
      "type": "integer",
      "description": "Number of IG posts found",
      "source": "step.scan_content.post_count"
    },
    "series_count": {
      "type": "integer",
      "description": "Number of series found",
      "source": "step.scan_content.series_count"
    },
    "idea_count": {
      "type": "integer",
      "description": "Number of ideas found",
      "source": "step.scan_content.idea_count"
    }
  }
}





