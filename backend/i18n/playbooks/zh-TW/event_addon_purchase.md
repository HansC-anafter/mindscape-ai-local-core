---
playbook_code: event_addon_purchase
version: 1.0.0
capability_code: walkto_lab
name: 活動附加購買
description: |
  為特定活動購買附加功能，記錄你的在場並建立可攜帶證據。
  購買確認 → 在場記錄 → 交付。
  注意：這是非核心附加功能，不影響主要共學軌道。
tags:
  - walkto
  - event
  - addon
  - purchase
  - optional

kind: user_workflow
interaction_mode:
  - conversational
  - needs_review
visible_in:
  - workspace_tools_panel
  - workspace_playbook_menu

required_tools:
  - cloud_capability.call

language_strategy: model_native
locale: zh-TW
supported_locales:
  - zh-TW
  - en
default_locale: en
auto_localize: true

entry_agent_type: coder
icon: 🎫
---

# 活動附加購買 - SOP

## 目標

讓使用者為特定活動購買附加功能，記錄在場並建立可攜帶證據。這是**非核心附加功能**，提供：

1. **購買確認**：確認購買資格並處理付款
2. **在場記錄**：記錄使用者在活動中的在場
3. **證據建立**：建立可攜帶的在場證據
4. **交付**：將證據交付給使用者

**核心價值**：
- 將單次活動參與轉化為可攜帶證據
- 建立你在特定活動中的在場記錄
- 帶走可獨立使用的證據

**重要注意事項**：
- 這**不是代購服務**（不為使用者購買商品）
- 這是「將活動在場轉為可攜帶證據」的插件
- 這**永遠不影響主要共學軌道**
- 這是可選的附加功能

## 執行步驟

### Phase 0: 準備

**執行順序**：
1. Step 0.0: 識別活動
2. Step 0.1: 檢查購買資格
3. Step 0.2: 確認附加功能詳情

#### Step 0.0: 識別活動

取得活動資訊：
- `event_id`: 活動識別碼
- `event_name`: 活動名稱
- `event_date`: 活動日期
- `event_location`: 活動地點
- `event_type`: 活動類型

**輸出**：
- `event_id`: 活動識別碼
- `event_info`: 活動資訊物件

#### Step 0.1: 檢查購買資格

檢查使用者是否可以購買附加功能：
- 驗證使用者有有效訂閱（Lens Feed 或 Annual Track）
- 檢查活動是否可購買附加功能
- 驗證活動日期有效
- 檢查使用者是否已為此活動購買附加功能

**資格檢查**：
```
購買資格檢查：

有效訂閱：[是/否] ✅/❌
活動可用：[是/否] ✅/❌
活動日期有效：[是/否] ✅/❌
已購買：[是/否] ✅/❌

符合資格：[是/否]
```

**輸出**：
- `eligible`: 布林值
- `eligibility_check`: 資格檢查結果
- `subscription_status`: 訂閱狀態

#### Step 0.2: 確認附加功能詳情

向使用者呈現附加功能詳情：
- 附加功能包含什麼
- 將建立什麼證據
- 價格與付款資訊
- 交付格式

**附加功能詳情格式**：
```
活動附加功能詳情：

活動：[活動名稱]
日期：[活動日期]
地點：[活動地點]

附加功能包含：
- 在場記錄
- 證據建立
- 可攜帶證據交付

價格：[價格]
付款：[付款方式]

證據格式：[格式]
```

**輸出**：
- `addon_details`: 附加功能詳情物件
- `user_confirmed`: 布林值（使用者確認購買）

### Phase 1: 購買確認

**執行順序**：
1. Step 1.0: 處理付款
2. Step 1.1: 建立購買記錄
3. Step 1.2: 確認購買

#### Step 1.0: 處理付款

處理附加功能付款：
- 收集付款資訊
- 處理付款交易
- 驗證付款成功

**付款處理**：
```
付款處理：

金額：[金額]
付款方式：[方式]
交易 ID：[交易 ID]

狀態：[處理中/成功/失敗]
```

**輸出**：
- `payment_processed`: 布林值
- `payment_status`: 付款狀態
- `transaction_id`: 交易識別碼

#### Step 1.1: 建立購買記錄

建立購買記錄：
- 在資料庫中記錄購買
- 將購買連結到使用者和活動
- 設定購買狀態

**購買記錄格式**：
```
購買記錄已建立：

購買 ID：[purchase_id]
使用者 ID：[user_id]
活動 ID：[event_id]
購買日期：[日期]
狀態：[active]
```

**輸出**：
- `purchase_id`: 購買識別碼
- `purchase_record`: 購買記錄物件
- `purchase_status`: 購買狀態

#### Step 1.2: 確認購買

向使用者確認購買：
- 顯示購買確認
- 提供購買詳情
- 說明下一步

**購買確認格式**：
```
購買已確認：

購買 ID：[purchase_id]
活動：[活動名稱]
日期：[活動日期]
金額：[金額]

下一步：
1. 參加活動
2. 記錄你的在場
3. 接收證據
```

**輸出**：
- `purchase_confirmed`: 布林值
- `confirmation_details`: 確認詳情物件

### Phase 2: 在場記錄

**執行順序**：
1. Step 2.0: 記錄活動參與
2. Step 2.1: 收集參與證據
3. Step 2.2: 驗證在場

#### Step 2.0: 記錄活動參與

記錄使用者在活動中的參與：
- 從使用者取得參與確認
- 記錄參與時間戳記
- 收集基本參與資訊

**參與記錄**：
```
活動參與已記錄：

活動：[活動名稱]
日期：[活動日期]
參與時間：[timestamp]
使用者：[user_id]

狀態：[已參與]
```

**輸出**：
- `attendance_recorded`: 布林值
- `attendance_timestamp`: 參與時間戳記
- `attendance_info`: 參與資訊物件

#### Step 2.1: 收集參與證據

收集參與證據：
- 活動照片（如提供）
- 筆記或觀察
- 活動素材
- 使用者想包含的其他證據

**證據收集**：
```
證據已收集：

照片：[數量] 張照片
筆記：[數量] 則筆記
素材：[數量] 個素材
其他：[其他證據]

總證據項目：[數量]
```

**輸出**：
- `evidence_collected`: 布林值
- `evidence_items`: 證據項目列表
- `evidence_count`: 總證據數量

#### Step 2.2: 驗證在場

驗證使用者的在場：
- 與活動記錄交叉檢查（如有）
- 驗證證據真實性
- 確認在場有效

**在場驗證**：
```
在場驗證：

參與已記錄：✅
證據已收集：✅
驗證：[已驗證/未驗證]

狀態：[有效/無效]
```

**輸出**：
- `presence_verified`: 布林值
- `verification_status`: 驗證狀態
- `verification_details`: 驗證詳情

### Phase 3: 證據建立

**執行順序**：
1. Step 3.0: 彙編證據
2. Step 3.1: 格式化證據
3. Step 3.2: 建立可攜帶證據

#### Step 3.0: 彙編證據

將所有證據彙編成單一套件：
- 組織照片、筆記、素材
- 建立證據摘要
- 結構化證據套件

**證據彙編**：
```
證據已彙編：

活動：[活動名稱]
日期：[活動日期]
使用者：[user_id]

證據套件：
- 照片：[數量]
- 筆記：[數量]
- 素材：[數量]
- 摘要：[摘要文字]

總項目：[數量]
```

**輸出**：
- `evidence_compiled`: 布林值
- `evidence_package`: 證據套件物件
- `package_summary`: 套件摘要

#### Step 3.1: 格式化證據

根據交付格式格式化證據：
- 格式化為請求格式（PDF/Markdown/Notion 等）
- 包含元資料與時間戳記
- 確保可攜帶性

**證據格式化**：
```
證據已格式化：

格式：[格式]
結構：[結構]
元資料：[已包含元資料]

準備交付：[是/否]
```

**輸出**：
- `evidence_formatted`: 布林值
- `formatted_evidence`: 格式化的證據物件
- `format_type`: 格式類型

#### Step 3.2: 建立可攜帶證據

建立最終可攜帶證據：
- 生成證據檔案
- 包含所有組成
- 確保證據完整

**可攜帶證據格式**：
```
可攜帶證據已建立：

檔案：[file_name]
格式：[format]
大小：[size]
組成：
- 參與記錄
- 照片
- 筆記
- 素材
- 摘要

狀態：[完整]
```

**輸出**：
- `portable_evidence`: 可攜帶證據物件
- `evidence_file`: 證據檔案路徑或 URL
- `evidence_complete`: 布林值

### Phase 4: 交付

**執行順序**：
1. Step 4.0: 呈現證據摘要
2. Step 4.1: 提供下載
3. Step 4.2: 確認交付

#### Step 4.0: 呈現證據摘要

向使用者呈現證據摘要：
- 顯示證據組成
- 顯示關鍵資訊
- 突出證據價值

**證據摘要格式**：
```
活動附加功能證據摘要

活動：[活動名稱]
日期：[活動日期]
購買 ID：[purchase_id]

證據組成：
- 參與記錄：[已包含]
- 照片：[數量] 張照片
- 筆記：[數量] 則筆記
- 素材：[數量] 個素材
- 摘要：[已包含]

格式：[format]
檔案大小：[size]
```

**輸出**：
- `summary_presented`: 布林值
- `evidence_summary`: 證據摘要物件

#### Step 4.1: 提供下載

提供下載連結或檔案：
- 分享下載連結
- 或提供直接檔案下載
- 包含說明

**下載格式**：
```
下載你的證據：

[下載連結] 或 [下載按鈕]

檔案：event_evidence_[event_id]_[user_id]_[timestamp].[ext]
格式：[format]
大小：[size]

有效期：[duration]
```

**輸出**：
- `download_provided`: 布林值
- `download_link`: 下載連結
- `download_instructions`: 下載說明

#### Step 4.2: 確認交付

確認證據交付：
- 驗證使用者已收到證據
- 確認證據可存取
- 如需要提供支援

**交付確認**：
```
證據已交付：

交付日期：[date]
交付狀態：[已交付]
存取：[可存取]

支援：[如需要可用]
```

**輸出**：
- `delivery_confirmed`: 布林值
- `delivery_status`: 交付狀態
- `delivery_metadata`: 交付元資料物件

## 驗收標準

### 購買確認
- ✅ 使用者符合購買附加功能資格
- ✅ 付款已成功處理
- ✅ 購買記錄已建立
- ✅ 購買已確認

### 在場記錄
- ✅ 活動參與已記錄
- ✅ 參與證據已收集
- ✅ 在場已驗證

### 證據建立
- ✅ 證據已彙編
- ✅ 證據已格式化
- ✅ 可攜帶證據已建立

### 交付
- ✅ 證據摘要已呈現
- ✅ 下載已提供
- ✅ 交付已確認

## 錯誤處理

### 準備錯誤
- 如果活動找不到：告知使用者並提供替代選項
- 如果使用者不符合資格：說明資格要求
- 如果活動不可用：告知使用者並建議替代選項

### 購買錯誤
- 如果付款失敗：重試付款或提供替代付款方式
- 如果購買記錄建立失敗：重試並告知使用者
- 如果購買確認失敗：驗證購買並重試

### 在場記錄錯誤
- 如果無法記錄參與：提示使用者提供資訊
- 如果證據收集失敗：重試收集或允許手動上傳
- 如果在場驗證失敗：檢視證據並重試

### 證據建立錯誤
- 如果證據彙編失敗：重試彙編
- 如果格式化失敗：修復格式問題並重試
- 如果可攜帶證據建立失敗：重試建立

### 交付錯誤
- 如果下載連結失敗：重新生成連結
- 如果檔案無法存取：檢查權限並重試
- 如果交付確認失敗：驗證交付並重試

## 注意事項

- 活動附加功能是**非核心可選功能**
- 這**不是代購服務**（不購買商品）
- 這是「將活動在場轉為可攜帶證據」的插件
- 這**永遠不影響主要共學軌道**
- 證據可攜帶且可獨立使用
- 附加功能需要有效訂閱（Lens Feed 或 Annual Track）













